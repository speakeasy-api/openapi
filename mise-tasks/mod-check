#!/usr/bin/env bash
set -euo pipefail

echo "üîç Checking if go.mod and go.sum are tidy..."

# Create a temporary copy of go.mod and go.sum
cp go.mod go.mod.bak
cp go.sum go.sum.bak

# Run go mod tidy
go mod tidy

# Check if files changed
if ! cmp -s go.mod go.mod.bak || ! cmp -s go.sum go.sum.bak; then
    echo "‚ùå go.mod or go.sum is not tidy!"
    echo "Please run 'mise run mod-tidy' to fix module dependencies."
    
    # Restore original files
    mv go.mod.bak go.mod
    mv go.sum.bak go.sum
    exit 1
fi

# Clean up backup files
rm go.mod.bak go.sum.bak

echo "‚úÖ go.mod and go.sum are tidy!"