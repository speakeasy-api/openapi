#!/usr/bin/env bash
set -euo pipefail

echo "ðŸ“¦ Tidying Go modules..."

while IFS= read -r gomod_file; do
    dir=$(dirname "$gomod_file")
    display="${dir#./}"
    [ "$display" = "." ] && display="root"
    echo "  â†’ $display"
    (cd "$dir" && go mod tidy)
done < <(find . -name "go.mod" -not -path "*/vendor/*" | sort)

echo "âœ… All Go modules tidied!"
